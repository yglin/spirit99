"use strict";angular.module("spirit99App",["ngMessages","ngAnimate","ngAria","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","ngPromiseExtras","uiGmapgoogle-maps","froala","truncate","ngFitText","ngStorage","duScroll","ngAudio","angular.validators","datePicker"]).config(["$routeProvider",function(a){a.when("/:stationName?",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("green").accentPalette("orange")}]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyB5rcT4tYhcrHp5NwEophBjfKV0uilCNEE",v:"3.17",libraries:"weather,geometry,visualization"})}]).config(["$provide","$httpProvider",function(a,b){a.decorator("$log",["$delegate",function(a){var b=["log","debug","info","warn","error"];return a.logHistory={ajax:[],maxLength:{ajax:1e3}},_.each(b,function(b){a.logHistory[b]=[],a.logHistory.maxLength[b]=1e3}),a.originalFunctions={},_.each(b,function(b){a.originalFunctions[b]=a[b],a[b]=_.wrap(a.originalFunctions[b],function(c){var d=Array.prototype.slice.call(arguments,1);for(c.apply(a,d),a.logHistory[b].push({timestamp:new Date,context:d});a.logHistory[b].length>a.logHistory.maxLength[b];)a.logHistory[b].shift()})}),a.getHistory=function(b){return a.logHistory[b]},a}]),b.interceptors.push(["$q","$log",function(a,b){return{responseError:function(c){for(b.logHistory.ajax.push({timestamp:new Date,context:c});b.logHistory.ajax.length>b.logHistory.maxLength.ajax;)b.logHistory.ajax.shift();return a.reject(c)}}}])}]).value("portalRules",{requiredFields:["name","title"]}),angular.module("spirit99App").controller("MainCtrl",["$scope",function(a){}]),angular.module("spirit99App").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("spirit99App").service("ygError",["$rootScope","$mdDialog","ygAudio",function(a,b,c){var d=this;d.errorMessages=[];var e=function(a){var d=b.confirm().title("那Ａ安內").content(a).ok("回報問題").cancel("喔 好");c.play("onError"),b.show(d).then(function(){b.show({controller:"ReportIssueController",templateUrl:"views/report-issue.html",clickOutsideToClose:!0})})};a.$watchCollection(function(){return d.errorMessages},function(a,b){for(;d.errorMessages.length>0;){var c=d.errorMessages.pop();e(c)}})}]),angular.module("spirit99App").service("ygUtils",["uiGmapGoogleMapApi",function(a){var b=this;b.clearNullAndEmptyStrings=function(a){for(var c in a)null===a[c]||""===a[c]?delete a[c]:"object"==typeof a[c]&&b.clearNullAndEmptyStrings(a[c])},b.fillDefaults=function(a,b){for(var c in b)c in a&&null!==a[c]||(a[c]=b[c]);return a},b.formatDatetime=function(a){var b=new Date(a);return b.toLocaleString()},b.formatDate=function(a){var b=new Date(a);return b.getFullYear()+"/"+(b.getMonth()+1)+"/"+b.getDate()},b.getHateoasLinks=function(a){var b={};if("link"in a&&a.link.length>0)for(var c=a.link.split(","),d=0;d<c.length;d++){var e=c[d].split(";");if(2!==e.length)throw new Error("section could not be split on ';'");var f=e[0].replace(/<(.*)>/,"$1").trim(),g=e[1].replace(/rel="(.*)"/,"$1").trim();b[g]=f}return b},b.historyBoundsUnion=null,b.maxBounds=null,b.resetMaxBounds=function(){b.historyBoundsUnion=null,b.maxBounds=null},b.updateMaxBounds=function(a){},b.withinMaxBounds=function(a){return!1},a.then(function(a){b.withinBounds=function(a,b){return b.contains(a.getSouthWest())&&b.contains(a.getNorthEast())?!0:!1},b.updateMaxBounds=function(c){var d=new a.LatLngBounds(new a.LatLng(c.southwest.latitude,c.southwest.longitude),new a.LatLng(c.northeast.latitude,c.northeast.longitude));null===b.historyBoundsUnion?(b.historyBoundsUnion=d,b.maxBounds=angular.copy(d)):(b.withinBounds(b.historyBoundsUnion,d)&&(b.maxBounds=d),b.historyBoundsUnion=b.historyBoundsUnion.union(d))},b.withinMaxBounds=function(c){if(null===b.maxBounds)return!1;var d=new a.LatLngBounds(new a.LatLng(c.southwest.latitude,c.southwest.longitude),new a.LatLng(c.northeast.latitude,c.northeast.longitude));return b.withinBounds(d,b.maxBounds)}})}]),angular.module("spirit99App").service("ygUserPref",["$q","$localStorage","$log",function(a,b,c){var d=this;d.$storage=b.$default({servers:{"nuclear-waste":{name:"nuclear-waste",title:"核廢料掩埋場",portalUrl:"http://spirit99-server-dev.elasticbeanstalk.com/nuclear-waste/portal",show:!0},localooxx:{name:"localooxx",title:"地方的ＯＯ需要ＸＸ",portalUrl:"http://spirit99-server-dev.elasticbeanstalk.com/localooxx/portal",show:!0}},map:{center:{latitude:23.973875,longitude:120.982024},bounds:{northeast:{latitude:18.862283857359866,longitude:106.13949470312502},southwest:{latitude:28.89053701901714,longitude:135.82455329687502}},zoom:6},mapHome:{center:{latitude:23.973875,longitude:120.982024},zoom:16},filterCircle:{center:{latitude:24.081665,longitude:120.538539},radius:1e3,stroke:{color:"#08B21F",weight:1,opacity:.25},fill:{color:"#08B21F",opacity:.25},clickable:!1,editable:!0,visible:!1},selectedServer:"nuclear-waste",startUpAtMap:"geolocation",autoOpenPostList:!0,soundFX:!0,showToastTips:!0,myPosts:{},commentedPosts:{},followedPosts:{}}),d.setMapHome=function(){d.$storage.mapHome=angular.copy(d.$storage.map)},d.promiseStartUpAtMap=function(){if("geolocation"===d.$storage.startUpAtMap)return d.promiseGetGeolocation(d.$storage.map);if("useMapHome"===d.$storage.startUpAtMap){for(var b in d.$storage.mapHome)b in d.$storage.map&&(d.$storage.map[b]=d.$storage.mapHome[b]);return a.resolve()}return a.resolve()},d.promiseGetGeolocation=function(b,d){c.info("Start get geolocation"),d="undefined"!=typeof d?d:15;var e=a.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){b.center={latitude:a.coords.latitude,longitude:a.coords.longitude},b.zoom=d,c.info("Finish get geolocation"),e.resolve()},function(a){e.reject(a.message)}):e.reject("Not support Navigator.geolocation"),e.promise},d.initialPromises={startUpAtMap:d.promiseStartUpAtMap()}}]),angular.module("spirit99App").service("ygServer",["$rootScope","$log","$routeParams","$http","$resource","$q","$mdDialog","uiGmapGoogleMapApi","nodeValidator","portalRules","ygError","ygUtils","ygUserPref","ygStatusInfo","ygAudio",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=this;p.portalDataDefaults={show:!0,logo:"https://www.evansville.edu/residencelife/images/greenLogo.png"},p.servers=m.$storage.servers,p.selectedServer=null,p.resources={},p.isSelectedServer=function(){return!angular.isUndefined(p.selectedServer)&&null!==p.selectedServer},p.validatePortal=function(a){for(var c=0;c<j.requiredFields.length;c++)if(!(j.requiredFields[c]in a))return b.error("Missing required field: "+j.requiredFields[c]+",\n in data: "+a),!1;return!0},p.switchServer=function(a){a in p.servers?(m.$storage.selectedServer=a,p.selectedServer=p.servers[a],p.selectedServer.show=!0,p.resources={}):b.warn("沒有找到"+a+"啊！你是不是忘記load啦？")},p.showServerIntro=function(a){a in p.servers?(o.play("openStationIntro"),g.show({templateUrl:"views/server-intro.html",controller:"ServerIntroController",clickOutsideToClose:!0,locals:{server:p.servers[a]},preserveScope:!0})):k.errorMessages.push("找不到電台資料："+a)},p.loadServer=function(a){if(!i.isURL(a)){var c="喂喂，你輸入的這個好像不是網址喔？<br>"+a;return k.errorMessages.push(c),void b.warn(c)}d.get(a).success(function(c,d){if(p.validatePortal(c))c.name in p.servers?p.updateServer(c):p.servers[c.name]=l.fillDefaults(c,p.portalDataDefaults),p.servers[c.name].portalUrl=a,p.servers[c.name].isReady=!0,p.showServerIntro(c.name);else{var e="載入失敗，請檢查傳送門網址是否正確<br>"+a;k.errorMessages.push(e),b.warn(e+" response:\n"+d+"\n"+c)}}).error(function(c,d){var e="載入失敗，請檢查傳送門網址是否正確<br>"+a;k.errorMessages.push(e),b.warn(e+" response:\n"+d+"\n"+c)})},p.removeServer=function(a){null!==p.selectedServer&&p.selectedServer.name===a&&(p.selectedServer=null),delete p.servers[a]},p.errorGetPortal=function(a,c,d,e){b.error("Failed to update server, portal url = "+e.url+", status = "+c+", response data = "+a)},p.updateServer=function(a){var c=a.name,e=p.servers[c],g=e.portalUrl;return a.urls&&a.urls.portalUrl&&(g=a.urls.portalUrl),g!==e.portalUrl&&i.isURL(g)?(b.info("Got new portal url , update from it: "+g),d.get(g).success(function(a){p.validatePortal(a)&&(p.servers[c]=l.fillDefaults(a,p.portalDataDefaults),p.servers[c].portalUrl=g,p.servers[c].isReady=!0)}).error(p.errorGetPortal)):p.validatePortal(a)?(p.servers[c]=l.fillDefaults(a,p.portalDataDefaults),p.servers[c].portalUrl=g,p.servers[c].isReady=!0,f.resolve()):(b.error("Invalid portal data:"+JSON.stringify(a)),f.reject("Invalid portal data:"+JSON.stringify(a)))},p.updateServers=function(){b.info("Start update servers"),n.statusProcessing("更新電台資料...");var a={};for(var c in p.servers)p.servers[c].isReady=!1,b.info("Update station "+c+" from "+p.servers[c].portalUrl),a[c]=d.get(p.servers[c].portalUrl).success(p.updateServer).error(p.errorGetPortal);var e=f.allSettled(a).then(function(a){b.info("Finish update servers"),n.statusIdle()});return e},p.getSupportPost=function(){return p.isSelectedServer()?"post"in p.resources?p.resources.post:"postUrl"in p.selectedServer.urls?(p.resources.post=e(p.selectedServer.urls.postUrl.replace(/\/+$/,"")+"/:id",{},{getMarkers:{method:"GET",isArray:!0,params:{fields:["id","title","latitude","longitude","icon","create_time","modify_time"]}},getDetails:{method:"GET",params:{fields:["author","context"]}},create:{method:"POST",transformRequest:function(a,b){for(var c=["id","title","context","author","icon","latitude","longitude"],d={},e=0;e<c.length;e++)c[e]in a&&(d[c[e]]=a[c[e]]);return"object"==typeof d&&(d=angular.toJson(d)),d}},update:{method:"PUT",headers:{password:function(a){var b="";return"password"in a.params&&(b=a.params.password,delete a.params.password),b}},transformRequest:function(a,b){for(var c=["title","context","author","icon","latitude","longitude"],d={},e=0;e<c.length;e++)c[e]in a&&(d[c[e]]=a[c[e]]);return"object"==typeof d&&(d=angular.toJson(d)),d}},"delete":{method:"DELETE",headers:{password:function(a){var b="";return"password"in a.params&&(b=a.params.password,delete a.params.password),b}}}}),p.resources.post):!1:!1},p.getSupportComment=function(){return p.isSelectedServer()?"comment"in p.resources?p.resources.comment:"commentUrl"in p.selectedServer.urls?(p.resources.comment=e(p.selectedServer.urls.commentUrl),p.resources.comment):!1:!1},p.getSupportFollowPost=function(){return p.isSelectedServer()&&"followPostBy"in p.selectedServer&&null!==p.selectedServer.followPostBy?!0:!1},p.getSupportIconSet=function(){return!1},h.then(function(a){p.getSupportIconSet=function(){if(!p.isSelectedServer())return!1;if("iconSet"in p.resources)return p.resources.iconSet;if("iconSet"in p.selectedServer&&null!==p.selectedServer.iconSet){p.resources.iconSet={"default":{url:"images/icon-chat-48.a8c88f3f.png",scaledSize:new a.Size(36,36)}};for(var b in p.selectedServer.iconSet){var c=p.selectedServer.iconSet[b];i.isURL(c)?p.resources.iconSet[b]={url:c,scaledSize:new a.Size(36,36)}:"object"==typeof c&&"url"in c&&(p.resources.iconSet[b]=c)}return p.resources.iconSet}return!1}}),p.getSupportVote=function(){return"vote"in p.resources?p.resources.vote:"voteUrl"in p.selectedServer.urls?(p.resources.vote=e(p.selectedServer.urls.voteUrl.replace(/\/+$/,"")+"/:id",{post_id:"@post_id",id:"@id"},{plusOne:{method:"PUT"},"delete":{method:"DELETE",headers:{password:function(a){var b="";return"password"in a.params&&(b=a.params.password,delete a.params.password),b}}}}),p.resources.vote):!1},p.getSupportUpload=function(){return"upload"in p.resources?p.resources.upload:"uploadToS3ConfigUrl"in p.selectedServer.urls?(p.resources.upload={s3Config:{},promiseS3Config:d.get(p.selectedServer.urls.uploadToS3ConfigUrl).then(function(a){return p.resources.upload.s3Config=a.data,f.resolve()},function(a){return f.reject(a)})},p.resources.upload):"uploadUrl"in p.selectedServer.urls?(p.resources.upload={url:p.selectedServer.urls.uploadUrl},"uploadParamName"in p.selectedServer&&(p.resources.upload.paramName=p.selectedServer.uploadParamName),p.resources.upload):!1},p.getSupportReportIssue=function(){return p.isSelectedServer()?"reportIssue"in p.resources?p.resources.reportIssue:"reportIssueUrl"in p.selectedServer.urls?(p.resources.reportIssue={url:p.selectedServer.urls.reportIssueUrl},p.resources.reportIssue):!1:!1},p.initialPromises={updateServers:p.updateServers()},p.initialPromises.updateServers.then(function(){"stationName"in c&&c.stationName in p.servers?(p.switchServer(c.stationName),p.showServerIntro(c.stationName)):m.$storage.selectedServer in p.servers&&p.switchServer(m.$storage.selectedServer),a.$watch(function(){return p.selectedServer},function(){o.reloadSoundSet(p.selectedServer.soundSet)})})}]),angular.module("spirit99App").service("ygFilter",function(){this.keywords={title:[]}}),angular.module("spirit99App").controller("SideNavController",["$scope",function(a){a.selectedPane="server-list",a.switchPane=function(b){a.selectedPane=b}}]),angular.module("spirit99App").controller("HeadBarController",["$scope","$rootElement","$mdSidenav","$mdDialog","ygToastTip","ygUserPref","ygUserCtrl","ygServer","ygFilter","ygAudio","ygUtils",function(a,b,c,d,e,f,g,h,i,j,k){var l=this;"title"in g.filters||(g.filters.title={keywords:[]}),"myPostsOption"in g.filters||(g.filters.myPostsOption=null),a.filters=g.filters,a.myPostsOptions=g.myPostsOptions,a.tools={search:{tooltip:"搜尋標題",fontIcon:"search",hints:["輸入搜尋關鍵字後按Enter","多個關鍵字的搜尋效果會累加"],hintIndex:0},address:{tooltip:"搜尋地址",fontIcon:"my_location",hints:["輸入地名或地址後按Enter",'點<i class="material-icons">swap_horiz</i>按鈕，切換多個搜尋的地點結果'],hintIndex:0},markers:{tooltip:"顯示／隱藏地圖標示",fontIcon:"place",hints:["點地圖標示按鈕來顯示／隱藏相關分類文章",'點<i class="material-icons">more_horiz</i>按鈕開啟更多選項'],hintIndex:0},period:{tooltip:"搜尋文章發佈時間",fontIcon:"access_time"},"my-posts":{tooltip:"我的。。。文章",fontIcon:"person"}},a.selectedTool="address",a.isShowFabActions=!1,a.showFabActions=function(){a.isShowFabActions=!0},a.hideFabActions=function(){a.isShowFabActions=!1},a.showToolHint=function(b){b in a.tools&&"hints"in a.tools[b]&&e.showToastTip(a.tools[b].hints[a.tools[b].hintIndex]).then(function(){a.tools[b].hintIndex=(a.tools[b].hintIndex+1)%a.tools[b].hints.length})},a.selectTool=function(b){a.selectedTool=b,a.showToolHint(b),a.hideFabActions()},a.iconSet={},h.initialPromises.updateServers.then(function(){a.$watch(function(){return h.selectedServer},function(){angular.isUndefined(h.selectedServer)||null===h.selectedServer?a.server={title:"請選擇電台",logo:"https://cdn0.iconfinder.com/data/icons/octicons/1024/radio-tower-128.png"}:a.server=h.selectedServer})}),a.showServerIntro=h.showServerIntro,a.iconCtrls=g.iconCtrls,a.iconCount=g.iconCount,a.$watch(function(){return g.iconCount},function(){a.iconCount=g.iconCount}),a.toggleIcon=function(b){a.iconCtrls[b].show=!a.iconCtrls[b].show,j.play("toggleIconCtrl")},a.openIconCtrl=function(){d.show({controller:"IconCtrlController",templateUrl:"views/icon-ctrl.html",clickOutsideToClose:!0})},a.openSidenav=function(){c("sidenav-left").open()},a.openPostList=function(){g.openPostList=!g.openPostList},a.styleOfViewListButton=g.openPostList?{color:"white"}:{color:"lightgrey"},a.$watch(function(){return g.openPostList},function(){a.styleOfViewListButton=g.openPostList?{color:"white"}:{color:"lightgrey"}}),a.onEnterAddress=function(a){a.length>0&&(g.userAddress=a)},a.isMultipleGeocodeLocations=!1,a.$watch(function(){return g.geocode.results.length},function(b){b>1?a.isMultipleGeocodeLocations=!0:a.isMultipleGeocodeLocations=!1}),a.nextGeocodeLocation=function(){g.geocode.currentIndex=(g.geocode.currentIndex+1)%g.geocode.results.length},a.unselectMyPostsOptions=function(){a.filters.myPostsOption=null},a.datePickerText="請選擇日期",a.create_time={},"create_time"in g.filters&&"startDate"in g.filters.create_time&&"endDate"in g.filters.create_time&&(a.create_time={startDate:new Date(g.filters.create_time.startDate),endDate:new Date(g.filters.create_time.endDate)},a.datePickerText=k.formatDate(a.create_time.startDate)+" ~ "+k.formatDate(a.create_time.endDate)),a.openDatePicker=function(){d.show({controller:"DatePickerController",templateUrl:"views/date-picker.html",locals:{create_time:a.create_time},clickOutsideToClose:!0}).then(function(b){a.create_time.startDate=b.startDate,a.create_time.endDate=b.endDate,"create_time"in g.filters||(g.filters.create_time={}),g.filters.create_time.startDate=b.startDate.toString(),g.filters.create_time.endDate=b.endDate.toString(),a.datePickerText=k.formatDate(a.create_time.startDate)+" ~ "+k.formatDate(a.create_time.endDate)})},a.clearDateFilter=function(){a.create_time={},"create_time"in g.filters&&delete g.filters.create_time,a.datePickerText="請選擇日期"},l.hints=['點 <i class="material-icons">menu</i> 開啟電台及設定面板',"點電台標題來顯示電台簡介",'點<md-button class="md-fab md-mini"></md-button>可切換快速工具','點 <i class="material-icons">view_list</i> 開啟文章列表'],l.hintIndex=0,a.showToastTip=function(){return e.showToastTip(l.hints[l.hintIndex]).then(function(){l.hintIndex=(l.hintIndex+1)%l.hints.length})}}]),angular.module("spirit99App").controller("MapController",["$scope","$log","$timeout","$mdDialog","ygToastTip","uiGmapGoogleMapApi","ygUtils","ygError","ygUserPref","ygUserCtrl","ygServer","ygPost","ygAudio",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=this;n.googleMapApi=null,a.mapIsReady=!1,a.map=i.$storage.map,a.mapControl={},a.mapEvents={},a.posts=l.filteredPosts,a.filterCircle=i.$storage.filterCircle,a.newPost=null,a.timeoutLoadPosts=null,a.clickedMarker={id:"spirit99-map-clicked-marker",coords:{latitude:23.973875,longitude:120.982024},options:{icon:"images/icon-question-48.f41874a1.png",visible:!1,draggable:!0},events:{click:function(a,b,c){var d=a.getPosition();l.createPost(d.lat(),d.lng()).then(function(){a.setVisible(!1)})}},control:{}},n.focusOnLocation=function(b,d){a.map.center={latitude:b.lat(),longitude:b.lng()},a.map.bounds={southwest:{latitude:d.getSouthWest().lat(),longitude:d.getSouthWest().lng()},northeast:{latitude:d.getNorthEast().lat(),longitude:d.getNorthEast().lng()}};var e=a.clickedMarker.control.getGMarkers();e.length>0&&(e[0].setPosition(b),e[0].setVisible(!0)),c.cancel(a.timeoutLoadPosts),a.timeoutLoadPosts=c(l.loadPosts,1e3)},a.infoWindow={coords:{latitude:23.973875,longitude:120.982024},show:!1,templateUrl:"views/infowindow.html",templateParameter:{},closeClick:function(){a.infoWindow.show=!1},options:{maxWidth:250}},a.onClickPostMarker=function(a,b,d){c.cancel(n.timeoutShowInfoWindow),c.cancel(n.timeoutCloseInfoWindow),c.cancel(n.timeoutOpenPostList),l.showPostDetail(d.id)},a.onMouseoverPostMarker=function(b,d,e){c.cancel(n.timeoutCloseInfoWindow),c.cancel(n.timeoutShowInfoWindow),j.focusedPostId=e.id,a.infoWindow.show?(a.infoWindow.coords={latitude:e.latitude,longitude:e.longitude},a.infoWindow.templateParameter=e,m.play("focusOnPost")):n.timeoutShowInfoWindow=c(function(){j.focusedPostId===e.id&&(a.infoWindow.coords={latitude:e.latitude,longitude:e.longitude},a.infoWindow.templateParameter=e,a.infoWindow.show=!0,m.play("focusOnPost"))},500),!j.openPostList&&i.$storage.autoOpenPostList&&(c.cancel(n.timeoutOpenPostList),n.timeoutOpenPostList=c(function(){j.focusedPostId===e.id&&(j.openPostList=!0)},3e3))},a.onMouseoutPostMarker=function(b,d,e){c.cancel(n.timeoutShowInfoWindow),a.infoWindow.show&&(n.timeoutCloseInfoWindow=c(function(){a.infoWindow.show=!1},2e3)),c.cancel(n.timeoutOpenPostList)},a.onDragendPostMarker=function(a,c,e){var f=d.confirm().parent(angular.element(document.body)).title("移到這裡").content("確定要把文章的地點移到這裡?").ariaLabel("Move Post").ok("確定").cancel("想想還是算了");d.show(f).then(function(){l.updatePost(e.id,{latitude:a.getPosition().lat(),longitude:a.getPosition().lng()})},function(){b.info("這樣就算了那這社會還需要警察嗎!? O_o")})},a.postMarkerEvents={click:a.onClickPostMarker,mouseover:a.onMouseoverPostMarker,mouseout:a.onMouseoutPostMarker,dragend:a.onDragendPostMarker},a.onClickMap=function(b,c,d){var e=a.clickedMarker.control.getGMarkers();e.length>=1&&(e[0].setPosition(d[0].latLng),e[0].setVisible(!0)),a.clickedMarker.options.visible=!0,l.createPost(d[0].latLng.lat(),d[0].latLng.lng()).then(function(a){e.length>=1&&e[0].setVisible(!1)},function(a){})},a.onDragendMap=function(b,d,e){c.cancel(a.timeoutLoadPosts),a.timeoutLoadPosts=c(l.loadPosts,1e3)},a.onZoomChangedMap=function(b,d,e){c.cancel(a.timeoutLoadPosts),a.timeoutLoadPosts=c(l.loadPosts,1e3)},n.mapHints=["在地圖上點一下來新增文章","指標移到地圖標示上來顯示文章標題跟縮圖","指標停在地圖標示上三秒後，會開啟文章列表"],n.mapHintsIndex=0,a.onMouseOverMap=function(a,b,c){e.showToastTip(n.mapHints[n.mapHintsIndex]).then(function(){n.mapHintsIndex=(n.mapHintsIndex+1)%n.mapHints.length}),j.isMouseOverMap=!0},a.onMouseOutMap=function(a,b,c){j.isMouseOverMap=!1},a.mapEvents={click:a.onClickMap,mouseover:a.onMouseOverMap,mouseout:a.onMouseOutMap,dragend:a.onDragendMap,zoom_changed:a.onZoomChangedMap},a.$watch(function(){return j.focusedPostId},function(b,c){if(!j.isMouseOverMap){var d=l.indexedPosts[b];d&&(a.infoWindow.coords={latitude:d.latitude,longitude:d.longitude},a.infoWindow.templateParameter=d,a.infoWindow.show=!0,a.map.center={latitude:d.latitude,longitude:d.longitude})}}),f.then(function(d){a.infoWindow.options.pixelOffset=new d.Size(0,-40),a.addMarkerAnimation=function(a,b){a.options="undefined"==typeof a.options?{}:a.options,a.options.animation=d.Animation.BOUNCE,c(function(){a.options.animation=null},b)},n.geocoder=new d.Geocoder,a.$watch(function(){return j.userAddress},function(c){c.length>0&&("function"==typeof n.watchNextGeocodeLocation&&n.watchNextGeocodeLocation(),j.geocode.results=[],j.geocode.currentIndex=0,n.geocoder.geocode({address:c},function(c,e){e===d.GeocoderStatus.OK?(n.focusOnLocation(c[0].geometry.location,c[0].geometry.viewport),c.length>1&&(j.geocode.results=c,j.geocode.currentIndex=0,n.watchNextGeocodeLocation=a.$watch(function(){return j.geocode.currentIndex},function(a){var b=j.geocode.results[a];n.focusOnLocation(b.geometry.location,b.geometry.viewport)}))):(b.warn("Geocode failed due to the following reason: "+e),e===d.GeocoderStatus.ZERO_RESULTS?h.errorMessages.push("找不到符合搜尋條件的地點"):h.errorMessages.push("搜尋失敗，請稍候再試"))}))}),a.mapIsReady=!0})}]),angular.module("spirit99App").controller("PostEditorController",["$scope","$mdDialog","$window","ygMyPost","ygUserCtrl","ygServer","ygFroala","newPost",function(a,b,c,d,e,f,g,h){g.getFroalaOptions().then(function(b){a.froalaOptions=b,a.froalaOptions.minHeight=150}),a.newPost=h,angular.isUndefined(a.newPost.context)&&(a.newPost.context=""),a.iconCtrls=e.iconCtrls,a.newPost.icon in a.iconCtrls||(a.newPost.icon=Object.keys(a.iconCtrls)[0]),a.triggerToolbar=function(){a.froalaOptions.froala("show",null)},a.insertImage=function(){a.froalaOptions.froala("show",null),a.froalaOptions.froala("showInsertImage")},a.selectMarkerIcon=function(b){a.newPost.icon=b},a.cancel=function(){b.cancel(a.newPost)},a.post=function(){b.hide(a.newPost)},a.voteResource=f.getSupportVote(),a.voteResource&&(a.newVote=new a.voteResource({expression:"言贊",count:0}),a.newVoteCount=0,a.addNewVote=function(){"newVotes"in a.newPost||(a.newPost.newVotes={}),a.newVoteCount+=1,a.newPost.newVotes[a.newVoteCount]=a.newVote,a.newVote=new a.voteResource({expression:"言贊",count:0})},a.removeNewVote=function(b){delete a.newPost.newVotes[b]},a.removeVote=function(b,e){var f=a.newPost.votes[b];angular.element("#post-editor-dialog");d.isMyPost(a.newPost)?c.confirm("刪除 "+f.expression+" 按鈕及資料: 有"+f.count+"人說 "+f.expression)&&(a.newPost.votes[b].tobeDeleted=!0):c.alert("無法刪除，找不到密碼或密碼錯誤，這可能不是你的文章喔")})}]),angular.module("spirit99App").controller("ProgressController",["$scope","message",function(a,b){a.message=b}]),angular.module("spirit99App").service("ygProgress",["$mdDialog",function(a){var b=this;b.circularProgress={templateUrl:"views/progress.html",controller:"ProgressController",locals:{message:"背景作業中..."}},b.show=function(c,d){var e={};c?(e=angular.copy(b.circularProgress),e.locals.message=c):e=e.circularProgress;a.show(e);a.hide()}}]),angular.module("spirit99App").controller("PostController",["$scope","$log","$resource","$mdDialog","ygUtils","ygMyPost","ygServer","ygFroala","ygPost","ygFollowPost","post",function(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.commentResource=g.getSupportComment(),a.isSupportComment=l.commentResource!==!1&&null!==l.commentResource,a.isLoadingComments=!1,a.isSupportComment&&(a.isLoadingComments=!0,l.commentResource.query({post_id:k.id},function(b,c){a.comments=b}).$promise["finally"](function(){a.isLoadingComments=!1}),a.newComment=new l.commentResource),h.getFroalaOptions().then(function(b){a.froalaOptions=b,a.froalaOptions.minHeight=50}),a.post=k,a.isMyPost=f.isMyPost(k),a.formatDatetime=e.formatDatetime,a.comments=[],a.canFollowPost=j.supportFollowPost,a.followPost=a.post.id in j.followedPosts,a.editPost=i.editPost,a.deletePost=i.deletePost,a.voteResource=g.getSupportVote(),a.voteResource&&("votes"in a.post||a.voteResource.query({post_id:a.post.id},function(b){if(b.length>0){a.post.votes={};for(var c=0;c<b.length;c++)a.post.votes[b[c].id]=b[c]}}),a.votePlusOne=function(b){a.voteResource.plusOne({post_id:a.post.id,id:b.id},function(a){"count"in a&&(b.count=a.count),b.disabled=!0})}),a.$watch("followPost",function(b){b?j.followPost(a.post):j.unfollowPost(a.post)}),a.addComment=function(c){a.isSupportComment&&a.newComment.$save({post_id:a.post.id}).then(function(b){a.comments.push(a.newComment),f.addMyCommented(a.post),j.followPost(a.post),a.followPost=a.post.id in j.followedPosts,a.newComment=new l.commentResource},function(a){b.error(a)})},a.cancel=function(){d.cancel()}}]),angular.module("spirit99App").controller("InfoWindowController",["$scope",function(a){}]),angular.module("spirit99App").controller("PostListController",["$scope","$q","$interval","$mdSidenav","ygUserCtrl","ygPost","ygAudio",function(a,b,c,d,e,f,g){a.mdComponentID="sidenav-postList",a.lockedOpen=!1,a.focusedPostId=-1,a.isMouseOverList=!1,a.isScrolling=!1,f.initialPromises.loadPosts["finally"](function(){a.posts=f.filteredPosts,a.$watch(function(){return e.openPostList},function(b,c){b!==c&&(a.lockedOpen=b,b?g.play("openPostList"):g.play("closePostList"))})}),a.onMouseOverList=function(){a.isMouseOverList=!0},a.onMouseLeaveList=function(){a.isMouseOverList=!1},c(function(){if(d("sidenav-postList").isLockedOpen()&&a.focusedPostId!==e.focusedPostId&&!a.isMouseOverList&&!a.isScrolling){var b=angular.element(document.getElementById("post-list-container")),c=angular.element(document.getElementById("post-"+e.focusedPostId));b.length>0&&c.length>0&&(a.isScrolling=!0,g.play("scrollPostList"),b.scrollToElementAnimated(c,50,2e3).then(function(){a.focusedPostId=e.focusedPostId,a.isScrolling=!1}))}},100),a.close=function(){e.openPostList=!1},a.onMouseOverPosts=function(b){g.play("focusOnPost"),a.focusedPostId=b,e.focusedPostId=b},a.onClickPost=function(a){f.showPostDetail(a)}}]),angular.module("spirit99App").service("ygPost",["$rootScope","$log","$window","$timeout","$q","$resource","nodeValidator","$mdDialog","uiGmapGoogleMapApi","ygUtils","ygUserPref","ygUserCtrl","ygServer","ygMyPost","ygError","ygFollowPost","ygStatusInfo","ygAudio",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=this;s.postDataDefaults={},s.filteredPosts=[],s.indexedPosts={},s.newPost=null,s.assignIconObject=function(a){},i.then(function(a){s.assignIconObject=function(a){var b=m.getSupportIconSet();g.isURL(a.icon)?a.iconObject=a.icon:b&&(a.icon in b?(a.iconName=a.icon,a.iconObject=b[a.iconName]):(a.iconName="default",a.iconObject=b["default"]))}}),s.filteredPosts.addAsMarker=function(a){s.getThumbnail(a),n.isMyPost(a)&&("options"in a||(a.options={}),a.options.draggable=!0),this.push(a)},s.validatePostData=function(a){return!0},s.filterPost=function(a,b){if(b="undefined"==typeof b?l.filters:b,angular.isDefined(b.myPostsOption)&&null!==b.myPostsOption){if("myPosts"===b.myPostsOption)return n.isMyPost(a)?!0:!1;if("commentedPosts"===b.myPostsOption)return n.isMyCommented(a)?!0:!1;if("followedPosts"===b.myPostsOption)return p.isFollowingPost(a)?!0:!1}if(a.iconName&&a.iconName in l.iconCtrls&&!l.iconCtrls[a.iconName].show)return!1;var c=!0;for(var d in b)if("myPostsOption"!==d){if(d in a)if("keywords"in b[d]&&"string"==typeof a[d])for(var e=0;e<b[d].keywords.length;e++){var f=b[d].keywords[e];if(-1===a[d].indexOf(f)&&(c=!1),!c)break}else if("startDate"in b[d]&&"endDate"in b[d]){var g=new Date(a[d]),h=new Date(b[d].startDate);h.setHours(0,0,0,0);var i=new Date(b[d].endDate);i.setHours(23,59,59,999),c=g>h&&i>g}else c=!1;else c=!1;if(!c)break}return c},s.loadPosts=function(){if(!m.isSelectedServer())return b.warn("No selected server"),e.reject("No selected server");var a=m.getSupportPost();if(!a)return b.warn("Post resource not supported by server"),e.reject("Post resource not supported by server");if(j.withinMaxBounds(k.$storage.map.bounds))return b.info("Bounds within max bounds, no need to load new posts"),e.resolve("Bounds within max bounds, no need to load new posts");var c={},d=k.$storage.filterCircle;return d.visible&&(c.filterCircle={center:d.center,radius:d.radius}),c.bounds=k.$storage.map.bounds,q.statusProcessing("讀取資料..."),a.query(c,function(a){b.info("Load "+a.length+" posts");for(var d=0;d<a.length;d++)if(!(a[d].id in s.indexedPosts)&&s.validatePostData(a[d])){var e=j.fillDefaults(a[d],s.postDataDefaults);s.assignIconObject(e),p.isFollowingPost(e)&&p.isSomethingNew(e)&&p.addNotification(e),s.indexedPosts[e.id]=e,s.filterPost(e)&&s.filteredPosts.addAsMarker(e)}j.updateMaxBounds(c.bounds),q.statusIdle()},function(a){b.warn(a),q.statusIdle()}).$promise},s.reloadPosts=function(){return b.info("Reload posts~ "),s.filteredPosts.length=0,s.indexedPosts={},j.resetMaxBounds(),s.loadPosts()},s.postEditor=function(a){return r.play("openPostEditor"),h.cancel(),h.show({templateUrl:"views/posteditor.html",controller:"PostEditorController",clickOutsideToClose:!0,escapeToClose:!1,locals:{newPost:a}})},s.createPost=function(a,c){var d=m.getSupportPost();return d?(null===s.newPost&&(s.newPost=new d,"whoami"in k.$storage&&(s.newPost.author=k.$storage.whoami)),s.newPost.latitude=angular.isUndefined(a)?s.newPost.latitude:a,s.newPost.longitude=angular.isUndefined(c)?s.newPost.longitude:c,s.postEditor(s.newPost).then(function(){return d.create(s.newPost,function(a){if(!s.validatePostData(a)||a.id in s.indexedPosts)return e.reject("Invalid post data: "+a.toString());var c=j.fillDefaults(a,s.postDataDefaults);s.assignIconObject(c),s.indexedPosts[c.id]=c,s.filterPost(s.indexedPosts[c.id])&&s.filteredPosts.addAsMarker(s.indexedPosts[c.id]),n.addMyPost(c),p.followPost(c);var d=m.getSupportVote(),f=s.newPost.newVotes;return d&&!angular.isUndefined(f)&&null!==f&&s.addVotes(a.id,f),k.$storage.whoami=s.newPost.author,s.newPost=null,b.info("Success, post added!!"),e.resolve()},function(a){return o.errorMessages.push("新增資料至遠端伺服器失敗"),e.reject(a)}).$promise},function(){return b.info("你又按錯啦你"),e.reject()})):(b.error("Post resource not supported by server"),e.reject("Post resource not supported by server"))},s.readPost=function(a){if("author"in a&&"context"in a)return e.resolve("Already got author and context, no need to read post");var d=m.getSupportPost();if(!d)return b.error("Post resource not supported by server"),e.reject("Post resource not supported by server");q.statusProcessing("讀取資料...");var f=d.getDetails({id:a.id},function(b){for(var c in b)c in a||(a[c]=b[c])},function(a){c.alert("讀取文章內容失敗"),b.error(a)}).$promise;return f["finally"](function(){q.statusIdle()}),f},s.updatePost=function(a,d){var f=m.getSupportPost();if(!f)return b.error("Post resource not supported by server"),e.reject("Post resource not supported by server");var g=s.indexedPosts[a],h=n.getPassword(g);if(!h)return c.alert("這可能是別人的文章，你沒有權限更改"),e.reject();s.filteredPosts.splice(s.filteredPosts.indexOf(g),1),q.statusProcessing("更新文章資料...");var i=f.update({id:a,password:h},d,function(b){s.indexedPosts[a]=b,s.assignIconObject(b);var c=m.getSupportVote();if(c){if("votes"in d)for(var e in d.votes)d.votes[e].tobeDeleted===!0&&c["delete"]({
post_id:a,id:e,password:h});"newVotes"in d&&null!==d.newVotes&&s.addVotes(a,d.newVotes)}},function(a){401===a.status?(c.alert("這可能是別人的文章，你沒有權限更改"),b.warn(a)):(c.alert("更新失敗!!"),b.error(a))}).$promise;return i["finally"](function(){s.filterPost(s.indexedPosts[g.id])&&s.filteredPosts.addAsMarker(s.indexedPosts[g.id]),q.statusIdle()}),i},s.editPost=function(a){var b=angular.copy(a);return s.postEditor(b).then(function(b){return s.updatePost(a.id,b)})},s.deletePost=function(a){var d=m.getSupportPost();if(!d)return b.error("Post resource not supported by server"),e.reject("Post resource not supported by server");if(n.isMyPost(a)){var f=h.confirm().title("刪除文章").content("確定要刪除<br><br><p><b>"+a.title+"</b></p><br><br>這篇文章?").ariaLabel("刪除文章").ok("確定").cancel("想想還是算了");return h.show(f).then(function(){s.filteredPosts.splice(s.filteredPosts.indexOf(a),1);var f=n.getPassword(a);return d["delete"]({id:a.id,password:f},function(b){return delete s.indexedPosts[a.id],e.resolve()},function(d){return s.filteredPosts.addAsMarker(a),401===d.status?c.alert("這可能是別人的文章，你沒有權限刪除"):(c.alert("刪除失敗!!"),b.error(d)),e.reject()}).$promise},function(){return b.info("那你再想想吧"),e.resolve()})}return c.alert("這可能是別人的文章，你沒有權限刪除"),e.reject()},s.showPostDetail=function(a){var b=s.indexedPosts[a];s.readPost(b).then(function(){r.play("openPostView"),h.show({templateUrl:"views/post.html",controller:"PostController",clickOutsideToClose:!0,locals:{post:b}})["finally"](function(){p.isFollowingPost(b)&&(p.removeNotification(b),p.checkPost(b))})})},s.addVotes=function(a,b){var c=m.getSupportVote();if(c)for(var d in b)b[d].$save({post_id:a})},s.getThumbnail=function(a){return a="number"==typeof a?s.indexedPosts[a]:a,a.thumbnail?e.resolve(a.thumbnail):s.readPost(a).then(function(){var b=/<img[^>]+src\s*=\s*"([^"\s]+)"/i,c=b.exec(a.context);return c?a.thumbnail=c[1]:a.thumbnail=null,e.resolve(a.thumbnail)},function(a){return b.error(a),e.reject(a)})},s.initialPromises={},s.initialPromises.loadPosts=e.allSettled([k.initialPromises.startUpAtMap,m.initialPromises.updateServers,i]).then(function(){var b=e.defer();return d(function(){s.reloadPosts().then(function(){b.resolve()},function(){b.reject()})},3e3),a.$watch(function(){return m.selectedServer},function(a,b){a!==b&&s.reloadPosts()}),a.$watch(function(){return l.filters},function(){s.filteredPosts.length=0;for(var a in s.indexedPosts)s.filterPost(s.indexedPosts[a])&&s.filteredPosts.addAsMarker(s.indexedPosts[a])},!0),a.$watch(function(){return l.iconCtrls},function(){s.filteredPosts.length=0;for(var a in s.indexedPosts)s.filterPost(s.indexedPosts[a])&&s.filteredPosts.addAsMarker(s.indexedPosts[a])},!0),b.promise})}]),angular.module("spirit99App").service("ygUserCtrl",["$rootScope","$q","nodeValidator","ygServer",function(a,b,c,d){var e=this;e.openPostList=!1,e.focusedPostId=-1,e.isMouseOverMap=!0,e.userAddress="",e.geocode={results:[],currentIndex:0},e.iconCtrls={},e.iconCount=0,e.refreshIconCtrls=function(a){var b;if(null!==a&&"iconSet"in a&&"object"==typeof a.iconSet&&null!==a.iconSet){for(b in e.iconCtrls)b in a.iconSet||delete e.iconCtrls[b];for(b in a.iconSet)c.isURL(a.iconSet[b])?e.iconCtrls[b]={url:a.iconSet[b],show:!0}:"url"in a.iconSet[b]&&(e.iconCtrls[b]={url:a.iconSet[b].url,show:!0});e.iconCount=Object.keys(e.iconCtrls).length}else{for(b in e.iconCtrls)delete e.iconCtrls[b];e.iconCount=0}},e.filters={},e.myPostsOptions={myPosts:"我的文章",commentedPosts:"我留言過的文章",followedPosts:"我追蹤的文章"},e.initialPromises={},e.initialPromises.refreshIconCtrls=d.initialPromises.updateServers.then(function(){return e.refreshIconCtrls(d.selectedServer),a.$watch(function(){return d.selectedServer},function(){e.refreshIconCtrls(d.selectedServer)}),b.resolve()})}]),angular.module("spirit99App").service("ygInit",["$q","$timeout","ygUserPref","ygUserCtrl","ygServer","ygPost","ygAudio","uiGmapGoogleMapApi","uiGmapIsReady",function(a,b,c,d,e,f,g,h,i){var j=this;console.log("Start initialization");var k=function(b,c){console.log("Start get geolocation"),c="undefined"!=typeof c?c:15;var d=a.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){b.center={latitude:a.coords.latitude,longitude:a.coords.longitude},b.zoom=c,console.log("Finish get geolocation"),d.resolve()},d.reject):d.reject("Not support Navigator.geolocation"),d.promise};h.then(function(a){j.GoogleMapsAPI=a}),i.promise(1).then(function(a){console.log("uiGmap is ready")});var l=[e.updateServers(),h,i.promise(1)];c.$storage.autoGeolocation&&l.push(k(c.$storage.map,16));var m=a.allSettled(l).then(function(){var d=e.servers[c.$storage.selectedServer];"soundSet"in d&&g.loadSoundSet(d.soundSet);var h=a.defer();return b(function(){f.reloadPosts().then(function(){h.resolve()},function(){h.reject()})},3e3),h.promise}),n=m.then(function(){return f.startWatches(),d.initialize(),a.resolve()});j.promise=n}]),angular.module("spirit99App").service("ygAudio",["$rootScope","ngAudio","ygUserPref",function(a,b,c){var d=this;d.defaultSoundSet={focusOnPost:{file:"sounds/water_drip_006.mp3",volume:.5},openPostList:{file:"sounds/water_bubbles_002.mp3",volume:.5},closePostList:{file:"sounds/large_water_drip.mp3",volume:.5},toggleIconCtrl:{file:"sounds/water_drip_009.mp3",volume:.5},openPostEditor:{file:"sounds/big_bubble_blown_into_glass_through_drinking_straw_version_2.mp3",volume:.5},openPostView:{file:"sounds/big_bubble_blown_into_glass_through_drinking_straw_version_1.mp3",volume:.5},onError:{file:"sounds/water_splash_in_flooded_bunker_006.mp3",volume:.5},openStationIntro:{file:"sounds/bubbles_blown_into_glass_through_drinking_straw_version_2.mp3",volume:.5}},d.play=function(a){c.$storage.soundFX&&a in d&&(d[a].progress=0,d[a].play())},d.loadSoundSet=function(a){for(var c in a)d[c]=b.load(a[c].file),d[c].volume=a[c].volume},d.reloadSoundSet=function(a){d.loadSoundSet(d.defaultSoundSet),angular.isDefined(a)&&null!==a&&d.loadSoundSet(a)}}]),angular.module("spirit99App").service("ygFollowPost",["$rootScope","uiGmapGoogleMapApi","ygServer","ygUserPref",function(a,b,c,d){var e=this;e.supportFollowPost=!1,e.followPostBy=[],e.followedPosts={},e.switchServer=function(a){e.followPostBy=a.followPostBy,angular.isUndefined(d.$storage.followedPosts[a.name])&&(d.$storage.followedPosts[a.name]={}),e.followedPosts=d.$storage.followedPosts[a.name]},c.initialPromises.updateServers.then(function(){e.supportFollowPost=c.getSupportFollowPost(),e.supportFollowPost&&e.switchServer(c.selectedServer),a.$watch(function(){return c.selectedServer},function(a){e.supportFollowPost=c.getSupportFollowPost(),e.supportFollowPost&&e.switchServer(c.selectedServer)})}),e.isFollowingPost=function(a){return e.supportFollowPost?a.id in e.followedPosts:!1},e.followPost=function(a){return e.supportFollowPost?void(a.id in e.followedPosts||(e.followedPosts[a.id]={})):!1},e.unfollowPost=function(a){return e.supportFollowPost?void(a.id in e.followedPosts&&delete e.followedPosts[a.id]):!1},e.checkPost=function(a){return e.supportFollowPost?(a.id in e.followedPosts||(e.followedPosts[a.id]={}),void(e.followPostBy.indexOf("modify_time")>-1&&(e.followedPosts[a.id].lastCheckTime=new Date))):!1},e.isSomethingNew=function(a){if(!e.supportFollowPost)return!1;if(e.followPostBy.indexOf("modify_time")>-1&&"modify_time"in a&&"lastCheckTime"in e.followedPosts[a.id]){var b=new Date(a.modify_time),c=new Date(e.followedPosts[a.id].lastCheckTime);if(b>c)return!0}return!1},e.addNotification=function(a){},e.removeNotification=function(a){},b.then(function(a){e.addNotification=function(b){b.options="undefined"==typeof b.options?{}:b.options,b.options.animation=a.Animation.BOUNCE},e.removeNotification=function(a){a.options&&a.options.animation&&(a.options.animation=null)}})}]),angular.module("spirit99App").service("ygStatusInfo",[function(){var a=this;a.statusIdle=function(){a.message="",a.isProgressing=!1},a.statusProcessing=function(b){a.message=b,a.isProgressing=!0}}]),angular.module("spirit99App").controller("StatusInfoController",["$scope","ygStatusInfo",function(a,b){a.message=b.message,a.$watch(function(){return b.message},function(){a.message=b.message}),a.showProgress=b.isProgressing,a.$watch(function(){return b.isProgressing},function(){a.showProgress=b.isProgressing})}]),angular.module("spirit99App").controller("UserSettingsController",["$scope","$log","$window","$mdDialog","ygUserPref","ygServer","ygFollowPost",function(a,b,c,d,e,f,g){a.settings=e.$storage,a.unfollowAllPosts=function(){d.show(d.confirm().title("停止追蹤文章").content("確定要停止追蹤目前追蹤中的所有文章？").ok("確定").cancel("我按錯了")).then(function(){for(var a in g.followedPosts)delete g.followedPosts[a]})},a.setMapHome=function(){d.show(d.confirm().title("設定地區首頁").content("將目前所瀏覽的地區範圍，設定為每次開啟網站時，地圖固定會顯示的範圍？").ok("確定").cancel("我按錯了")).then(function(){a.settings.startUpAtMap="useMapHome",e.setMapHome()})},a.reportIssue=function(){return a.canReportIssue=f.getSupportReportIssue(),a.canReportIssue?void d.show({controller:"ReportIssueController",templateUrl:"views/report-issue.html",clickOutsideToClose:!0}):void c.alert("電台不支援問題回報功能")}}]),angular.module("spirit99App").controller("ServerListController",["$scope","$log","$mdDialog","ygUserPref","ygServer",function(a,b,c,d,e){e.initialPromises.updateServers.then(function(){a.servers=e.servers}),a.addServer=function(a){e.loadServer(a)},a.removeServer=function(a){var d=c.confirm().parent(angular.element(document.body)).title("移除電台").content("確定要移除電台："+e.servers[a].title+"?").ariaLabel("Remove Server").ok("確定").cancel("對不起我按錯了");c.show(d).then(function(){b.info("去死吧! "+e.servers[a].title+"去死!"),e.removeServer(a)},function(){b.info("阿不就按錯了!? O_o")})},a.showServerIntro=e.showServerIntro}]),angular.module("spirit99App").controller("ServerIntroController",["$scope","$sce","$mdDialog","nodeValidator","ygServer","server",function(a,b,c,d,e,f){a.server=f,a.introUrl=null,a.introContent="這電台沒提供簡介...",null!==a.server&&"intro"in a.server&&(d.isURL(a.server.intro)?(a.introUrl=b.trustAsResourceUrl(a.server.intro),a.introContent=""):"string"==typeof a.server.intro&&(a.introUrl="",a.introContent=a.server.intro)),a.isAlreadySelected=null!==a.server&&null!==e.selectedServer&&a.server.name===e.selectedServer.name,a.switchServer=function(a){e.switchServer(a),c.hide()},a.cancel=function(){c.cancel()}}]),angular.module("spirit99App").service("ygFroala",["$rootScope","$log","$q","ygServer",function(a,b,c,d){var e=this;e.defaultOptions={inlineMode:!0,minHeight:150,language:"zh-tw",placeholder:"內文..."},e.options=null,e.getFroalaOptions=function(){var a=c.defer();if(null!==e.options)a.resolve(e.options);else{var f=d.getSupportUpload();if(f)if(f.s3Config)f.promiseS3Config.then(function(){var b={imageUploadToS3:{bucket:f.s3Config.bucket,region:f.s3Config.region,keyStart:f.s3Config.keyStart,callback:function(a,b){},params:{acl:f.s3Config.acl,AWSAccessKeyId:f.s3Config.accessKeyId,policy:f.s3Config.policy,signature:f.s3Config.signature}}};e.options=angular.extend(e.defaultOptions,b),a.resolve(e.options)},function(c){b.warn(c),a.resolve(e.defaultOptions)});else if(f.url){var g={imageUploadURL:f.url};f.paramName&&(g.imageUploadParam=f.paramName),e.options=angular.extend(e.defaultOptions,g),a.resolve(e.options)}else e.options=e.defaultOptions,a.resolve(e.options);else e.options=e.defaultOptions,a.resolve(e.options)}return a.promise},a.$watch(function(){return d.selectedServer},function(){e.options=null})}]),angular.module("spirit99App").service("ygMyPost",["$rootScope","ygUserPref","ygServer",function(a,b,c){var d=this;d.myPosts={},d.myCommented={},d.switchServer=function(a){angular.isUndefined(b.$storage.myPosts)&&(b.$storage.myPosts={}),angular.isUndefined(b.$storage.myPosts[a.name])&&(b.$storage.myPosts[a.name]={}),d.myPosts=b.$storage.myPosts[a.name],angular.isUndefined(b.$storage.myCommented)&&(b.$storage.myCommented={}),angular.isUndefined(b.$storage.myCommented[a.name])&&(b.$storage.myCommented[a.name]={}),d.myCommented=b.$storage.myCommented[a.name]},c.initialPromises.updateServers.then(function(){d.switchServer(c.selectedServer),a.$watch(function(){return c.selectedServer},function(){d.switchServer(c.selectedServer)})}),d.isMyPost=function(a){return a.id in d.myPosts},d.addMyPost=function(a){d.isMyPost(a)||(d.myPosts[a.id]={}),"password"in a&&(d.myPosts[a.id].password=a.password)},d.getPassword=function(a){return d.isMyPost(a)&&"password"in d.myPosts[a.id]?d.myPosts[a.id].password:null},d.isMyCommented=function(a){return a.id in d.myCommented},d.addMyCommented=function(a){d.isMyCommented(a)?d.myCommented[a.id].count+=1:(d.myCommented[a.id]={},d.myCommented[a.id].count=1)}}]),angular.module("spirit99App").controller("DatePickerController",["$scope","$mdDialog","create_time",function(a,b,c){"startDate"in c?a.startDate=c.startDate:(a.startDate=new Date,a.startDate.setFullYear(a.startDate.getFullYear()-1)),"endDate"in c?a.endDate=c.endDate:a.endDate=new Date,a.cancel=function(){b.cancel()},a.confirm=function(){b.hide({startDate:a.startDate,endDate:a.endDate})}}]),angular.module("spirit99App").controller("IconCtrlController",["$scope","ygUserCtrl","ygAudio",function(a,b,c){a.iconCtrls=b.iconCtrls,a.toggleIcon=function(b){a.iconCtrls[b].show=!a.iconCtrls[b].show,c.play("toggleIconCtrl")},a.hideAll=function(){for(var b in a.iconCtrls)a.iconCtrls[b].show=!1},a.showAll=function(){for(var b in a.iconCtrls)a.iconCtrls[b].show=!0}}]),angular.module("spirit99App").controller("ReportIssueController",["$scope","$log","$http","$window","$mdDialog","ygFroala","ygServer",function(a,b,c,d,e,f,g){f.getFroalaOptions().then(function(b){a.froalaOptions=b,a.froalaOptions.minHeight=100}),a.issue={description:'<p>天殺的這網站是怎樣#@$%!!</p><img src="http://static2.fjcdn.com/thumbnails/comments/5483060+_11224083b0f38dbfdfb203db56bfe1d3.gif" />'},a.issue.error_logs=b.getHistory("error").concat(b.getHistory("ajax")),a.issue.error_logs.sort(function(a,b){return a.timestamp-b.timestamp}),a.readableLogs=a.issue.error_logs.map(function(a){return{timestamp:a.timestamp.toLocaleString(),context:angular.toJson(a.context)}}),a.cancel=function(){e.cancel()},a.confirm=function(){var f=g.getSupportReportIssue();f?(a.isSendingLogHistory||(a.issue.error_logs=[]),c.post(f.url,a.issue).then(function(a){d.alert("問題已成功回報，感謝您為網站的進步盡一份心力:)"),b.info("Issue reported: "),b.info(a)},function(a){d.alert("問題回報失敗"),b.error("Issuse report failed: "),b.error(a)})):d.alert("電台不支援問題回報功能"),e.hide()}}]),angular.module("spirit99App").service("ygToastTip",["$q","$mdToast","ygUserPref",function(a,b,c){var d=this;d.isShowingToast=!1,d.showToastTip=function(e){return c.$storage.showToastTips&&!d.isShowingToast?(d.isShowingToast=!0,b.show({template:"<md-toast>"+e+"</md-toast>"})["finally"](function(){d.isShowingToast=!1})):a.reject()}}]),angular.module("spirit99App").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/date-picker.html",'<div layout="row" class="md-headline" layout-padding layout-margin> 開始日期<span flex></span>結束日期 </div> <div date-range start="startDate" end="endDate" max-view="year" min-view="date"></div> <div layout="row"> <md-button class="md-primary md-raised" ng-click="cancel()">算了</md-button> <div flex></div> <md-button class="md-primary md-raised" ng-click="confirm()">確定</md-button> </div>'),a.put("views/headbar.html",'<md-toolbar ng-cloak ng-mouseover="showToastTip()"> <div layout="row" layout-align="start center"> <div flex="10" layout="row"> <md-button class="md-icon-button" aria-label="Open Side Menu" ng-click="openSidenav()"> <md-tooltip class="md-body-2"> 選單 </md-tooltip> <md-icon class="material-icons" ng-style="{color: \'white\'}">menu</md-icon> </md-button> <md-button class="md-icon-button" aria-label="Open Posts List" ng-click="openPostList()"> <md-tooltip class="md-body-2"> 文章列表 </md-tooltip> <md-icon class="material-icons" ng-style="styleOfViewListButton">view_list</md-icon> </md-button> </div> <div flex="30" layout="row" layout-align="end center" ng-mouseover="showToolHint(selectedTool)"> <div style="position:relative;width:48px;height:48px"> <div style="position:absolute;top:0px;left:0px"> <md-fab-speed-dial md-direction="down" class="md-scale"> <md-fab-trigger> <md-button class="md-fab md-mini" ng-mouseover="showFabActions()"> <md-tooltip class="md-body-2"> 快速工具 </md-tooltip> <md-icon class="material-icons" ng-style="{color: \'white\'}">{{tools[selectedTool].fontIcon}}</md-icon> </md-button> </md-fab-trigger> <md-fab-actions ng-show="isShowFabActions" ng-mouseleave="hideFabActions()"> <md-button ng-repeat="(name, tool) in tools" class="md-fab md-mini" ng-click="selectTool(name)"> <md-tooltip class="md-body-2" md-direction="right"> {{tool.tooltip}} </md-tooltip> <md-icon class="material-icons" ng-style="{color: \'white\'}">{{tool.fontIcon}}</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </div> </div> <div flex layout-padding ng-show="selectedTool == &quot;search&quot;"> <md-chips ng-model="filters.title.keywords" md-transform-chip="addSearchKeyword($chip)"> <input placeholder="搜尋標題" style="font-size:20px;color:white"> </md-chips> </div> <div flex layout="row" layout-padding ng-show="selectedTool == &quot;address&quot;"> <md-input-container flex md-no-float> <input placeholder="請輸入地址或地名" style="color:white" ng-model="userAddress" ng-keypress="$event.keyCode == 13 && onEnterAddress(userAddress)"> </md-input-container> <md-button class="md-icon-button" aria-label="Next location" ng-click="nextGeocodeLocation()" ng-show="isMultipleGeocodeLocations"> <md-icon class="material-icons" ng-style="{color: \'white\'}">swap_horiz</md-icon> </md-button> </div> <div flex layout="row" layout-align="center center" ng-show="selectedTool == &quot;markers&quot;"> <md-button ng-repeat="(name, icon) in iconCtrls" ng-if="$index < 6" class="md-icon-button" aria-label="Marker Icon" ng-click="toggleIcon(name)" style="width:36px;height:36px"> <img ng-src="{{icon.url}}" ng-class="{&quot;s99-transparent&quot;: icon.show==false}" width="100%" height="100%"> <md-tooltip class="md-title">{{name}}</md-tooltip> </md-button> <md-button class="md-icon-button" aria-label="More Icons" ng-click="openIconCtrl()" style="width:24px"> <md-icon md-menu-origin class="material-icons" ng-style="{color: \'white\'}">more_horiz</md-icon> </md-button> </div> <div flex layout="row" layout-padding layout-align="start center" ng-show="selectedTool == &quot;period&quot;"> <md-button class="md-raised" md-menu-origin aria-label="Pick date range" ng-click="openDatePicker()"> {{ datePickerText }} </md-button> <div flex>發佈</div> <md-button class="md-icon-button" ng-click="clearDateFilter()"> <md-icon class="material-icons" ng-style="{color: \'white\'}">clear</md-icon> </md-button> </div> <div flex layout="row" layout-align="center center" layout-padding ng-show="selectedTool == &quot;my-posts&quot;"> <md-select flex style="margin:0" placeholder="我的..." ng-model="filters.myPostsOption"> <md-option ng-repeat="(name, title) in myPostsOptions" value="{{name}}"> {{title}} </md-option> </md-select> <md-button class="md-icon-button" ng-click="unselectMyPostsOptions()"> <md-icon class="material-icons" ng-style="{color: \'white\'}">clear</md-icon> </md-button> </div> </div> <div flex layout="row" layout-align="start center" ng-click="showServerIntro(server.name)" style="cursor:pointer"> <md-tooltip class="md-body-2"> 電台簡介 </md-tooltip> <div layout-margin> <img alt="{{server.title}}" ng-src="{{server.logo}}" class="md-avatar" ng-style="{\'max-width\':\'48px\', \'max-height\':\'48px\'}" ng-hide="server.logo == &quot;&quot;"> </div> <div class="md-headline" style="font-family: Microsoft JhengHei;color:white;white-space:nowrap">{{server.title}}</div> </div> <div flex></div> <div flex layout="row" layout-padding layout-align="end center"> <ng-include src="&quot;views/statusinfo.html&quot;"></ng-include> </div> </div> </md-toolbar>'),a.put("views/icon-ctrl.html",'<md-dialog-content> <h3>點地圖標示按鈕來顯示／隱藏相關分類文章</h3> <div layout="row" layout-wrap> <md-button ng-repeat="(name, icon) in iconCtrls" class="md-icon-button" aria-label="Marker Icon" ng-click="toggleIcon(name)"> <img ng-src="{{icon.url}}" ng-class="{&quot;s99-transparent&quot;: icon.show==false}" width="100%" height="100%"> <md-tooltip class="md-title">{{name}}</md-tooltip> </md-button> </div> <br> <div layout="row"> <md-button class="md-primary md-raised" ng-click="hideAll()">全部隱藏</md-button> <md-button class="md-primary md-raised" ng-click="showAll()">全部顯示</md-button> <div flex></div> </div> </md-dialog-content>'),a.put("views/infowindow.html",'<div ng-controller="InfoWindowController" layout="row" layout-align="space-around center"> <div ng-show="parameter.thumbnail"> <img ng-src="{{parameter.thumbnail}}" style="max-width:96px;min-width:48px;max-height:96px;min-height:48px"> </div> <div layout-margin layout-padding>{{ parameter.title }}</div> </div>'),a.put("views/main.html",'<div class="container" ng-include="&quot;views/sidenav.html&quot;" ng-controller="SideNavController"> </div> <div class="container" ng-include="&quot;views/headbar.html&quot;" ng-controller="HeadBarController"> </div> <div layout="row" style="height:90vh"> <div class="container" ng-include="&quot;views/post-list.html&quot;" ng-controller="PostListController" style="height:100%"></div> <div flex class="container" ng-include="&quot;views/map.html&quot;" ng-controller="MapController" style="height:100%"> </div> </div>'),a.put("views/map.html",'<md-content> <style type="text/css">.angular-google-map-container { height: 80vh; }</style> <div layout="column" layout-align="center center" style="height:100%" ng-show="!mapIsReady"> <p style="font-size:200%">地圖讀取中...</p> <md-progress-circular md-mode="indeterminate" class="md-accent"></md-progress-circular> </div> <ui-gmap-google-map center="map.center" pan="true" zoom="map.zoom" bounds="map.bounds" events="mapEvents" control="mapControl" ng-show="mapIsReady"> <!-- New post marker, show up when clicked on map --> <ui-gmap-marker idkey="clickedMarker.id" coords="clickedMarker.coords" options="clickedMarker.options" events="clickedMarker.events" control="clickedMarker.control"> </ui-gmap-marker> <!-- Post markers, load from server --> <ui-gmap-markers models="posts" coords="&quot;self&quot;" icon="&quot;iconObject&quot;" options="&quot;options&quot;" events="postMarkerEvents" docluster="true"> </ui-gmap-markers> <!-- pop up info window when bouse cursor over markers --> <ui-gmap-window coords="infoWindow.coords" show="infoWindow.show" closeclick="infoWindow.closeClick()" options="infoWindow.options" templateurl="infoWindow.templateUrl" templateparameter="infoWindow.templateParameter"> </ui-gmap-window> <!-- Filter circle --> <!--         <ui-gmap-circle center=\'filterCircle.center\' radius=\'filterCircle.radius\' stroke=\'filterCircle.stroke\' fill=\'filterCircle.fill\' clickable=\'filterCircle.clickable\' editable=\'filterCircle.editable\' visible=\'filterCircle.visible\' events=\'filterCircleEvents\'>\n        </ui-gmap-circle>\n --> <!-- Debug: bounds rectangles --> <!--         <ui-gmap-rectangle bounds="rectangleBounds" fill="\'#FFFFFF .5\'"></ui-gmap-rectangle>\n        </ui-gmap-google-map>\n --> </ui-gmap-google-map> </md-content>'),a.put("views/post-list.html",'<div flex="100" style="position:relative;height:0px"> <a href="" style="position:absolute;top:0px;right:-10px;z-index:5;text-decoration:none" ng-click="close()"> <md-icon class="material-icons">highlight_off</md-icon> </a> </div> <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="sidenav-postList" md-is-locked-open="lockedOpen" style="height:100%"> <md-content id="post-list-container" layout-padding style="height:100%;padding:10px" ng-mouseover="onMouseOverList()" ng-mouseleave="onMouseLeaveList()"> <md-list> <md-list-item id="post-{{post.id}}" ng-repeat="post in posts" ng-class="{&quot;md-whiteframe-z1&quot;:post.id!=focusedPostId, &quot;md-accent md-title md-whiteframe-z5&quot;:post.id==focusedPostId}" ng-mouseover="onMouseOverPosts(post.id)" ng-click="onClickPost(post.id)"> <div ng-show="post.thumbnail" layout-padding> <img ng-src="{{post.thumbnail}}" style="max-width:96px;min-width:48px;max-height:96px;min-height:48px"> </div> <div layout-margin layout-padding> {{post.title}} </div> </md-list-item> </md-list> </md-content> </md-sidenav>'),a.put("views/post.html",'<md-dialog aria-label="View Post" flex="60"> <md-toolbar> <div class="md-toolbar-tools md-toolbar-tools-bottom"> <div flex="50"> <div> <a data-fittext data-fittext-max="36" data-fittext-min="18">{{ post.title | words: 20 | characters: 50 }}</a> </div> </div> <div flex layout="column" layout-align="center end"> <div layout="row" layout-align="end center" style="min-height:20px;max-height:32px"> <div data-fittext data-fittext-max="24" data-fittext-min="14">{{ post.author }}</div> <md-button class="md-icon-button" style="width:24px;min-height:24px;height:24px;line-height:24px" ng-show="isMyPost" ng-click="editPost(post)"> <md-tooltip class="md-body-2" md-direction="top">修改文章</md-tooltip> <md-icon class="material-icons" style="color:white;font-size:20px">edit</md-icon> </md-button> <md-button class="md-icon-button" style="width:24px;min-height:24px;height:24px;line-height:24px" ng-show="isMyPost" ng-click="deletePost(post)"> <md-tooltip class="md-body-2" md-direction="top">刪除文章</md-tooltip> <md-icon class="material-icons" style="color:white;font-size:20px">delete</md-icon> </md-button> </div> <div layout="row" style="min-height:20px;max-height:32px"> <span flex></span> <div>{{ formatDatetime(post.create_time) }} 發佈</div> </div> </div> </div> </md-toolbar> <md-dialog-content> <md-content layout="column" layout-margin layout-padding> <!-- Post context --> <md-content layout-padding style="min-height:100px" ng-bind-html="post.context"> </md-content> <div layout="row" layout-align="space-between start"> <div flex layout="column"> <div ng-if="voteResource"> <div ng-repeat="vote in post.votes" layout="row"> <md-button type="button" class="md-accent md-raised" ng-click="votePlusOne(vote)" ng-disabled="::vote.disabled">{{vote.expression}}</md-button> <span>有 <b>{{vote.count | number}}</b> 個人說：</span><div class="md-headline">{{vote.expression}}</div> </div> </div> </div> <div flex="20" ng-show="canFollowPost"> <md-checkbox ng-model="followPost" ng-click="toggleFollowPost()"> <md-tooltip class="md-body-2">文章更新內容或有新的留言請提示我</md-tooltip> 追蹤本篇 </md-checkbox> </div> </div> <br> <md-divider></md-divider> <br> <div flex ng-show="isLoadingComments" layout="row" layout-align="center center"> <div style="font-size:200%">讀取留言...</div> <md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular> </div> <!-- List user comments --> <md-list> <md-list-item class="md-3-line md-whiteframe-z2" ng-repeat="comment in comments | orderBy:&quot;create_time&quot;"> <div class="md-list-item-text" layout-margin layout-padding> <h3>{{ comment.author }}</h3> <h5>{{ formatDatetime(comment.create_time) }}</h5> <md-content layout-padding style="min-height:50px" ng-bind-html="comment.context"> </md-content> </div> </md-list-item> </md-list> <br> <!-- New comment inputs --> <form name="commentForm" ng-show="isSupportComment" ng-if="froalaOptions"> <div layout="row"> <div flex="10" layout-padding> <img src="images/icon-comment-48.58c1bf48.png"> </div> <div flex layout="column"> <md-input-container> <div class="md-whiteframe-z3" layout-padding> <textarea required name="context" aria-label="comment" froala="froalaOptions" ng-model="newComment.context"></textarea> </div> <div ng-messages="commentForm.context.$error"> <div ng-message="required">留言必須有內容</div> </div> </md-input-container> <div layout="row" layout-align="space-around center"> <md-input-container flex> <label>作者</label> <input name="author" required ng-model="newComment.author"> <ng-messages for="commentForm.author.$error"> <ng-message when="required">留言必須有作者</ng-message> </ng-messages> </md-input-container> <div> <md-button type="button" ng-click="addComment(newComment)" ng-disabled="!newComment.context || !newComment.author">發表</md-button> </div> </div> </div> </div> </form> </md-content> </md-dialog-content> </md-dialog>'),a.put("views/posteditor.html",'<md-dialog id="post-editor-dialog" aria-label="Tell your story" flex="60"> <md-toolbar> <div class="md-toolbar-tools"> <h2>編輯文章</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon class="material-icons">clear</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div layout="row" layout-wrap> <md-button type="button" class="md-icon-button" ng-repeat="(name, icon) in iconCtrls" aria-label="Marker Icon" ng-click="selectMarkerIcon(name)"> <img ng-src="{{icon.url}}" width="100%" height="100%" ng-class="{&quot;s99-transparent&quot;: name != newPost.icon}"> <md-tooltip class="md-title">{{name}}</md-tooltip> </md-button> </div> <form name="postForm"> <md-input-container> <label>標題</label> <!-- TODO: limit character length to 50  --> <input md-maxlength="50" required name="title" ng-model="newPost.title"> <div ng-messages="postForm.title.$error"> <div ng-message="required">請填入標題</div> <div ng-message="md-maxlength">請勿超過50字</div> </div> </md-input-container> <br> <md-content layout="column" class="md-whiteframe-z3" ng-if="froalaOptions"> <!-- <div layout=\'row\'> --> <md-toolbar class="md-accent md-hue-1"> <div class="md-toolbar-tools md-toolbar-tools-bottom"> <md-button type="button" aria-label="Show Tools" class="md-fab md-raised md-mini" ng-click="triggerToolbar()"> <md-icon class="material-icons">menu</md-icon> <md-tooltip class="md-body-2">工具列</md-tooltip> </md-button> <md-button type="button" aria-label="Insert Image" class="md-fab md-raised md-mini" ng-click="insertImage()"> <md-icon class="material-icons">image</md-icon> <md-tooltip class="md-body-2">上傳圖片</md-tooltip> </md-button> <span flex></span> </div> </md-toolbar> <!-- </div> --> <md-input-container> <textarea aria-label="context-textarea" required name="context" froala="froalaOptions" ng-model="newPost.context"></textarea> <div ng-messages="postForm.context.$error"> <div ng-message="required">請填入內容</div> </div> </md-input-container> </md-content> <br> <md-input-container> <!-- TODO: limit character length to 30 --> <label>作者或聯絡方式</label> <input required md-maxlength="30" name="author" ng-model="newPost.author"> <div ng-messages="postForm.author.$error"> <div ng-message="required">請填入作者或聯絡方式</div> <div ng-message="md-maxlength">請勿超過30字</div> </div> </md-input-container> <div ng-if="voteResource !== false"> <div ng-repeat="(id, vote) in newPost.votes" ng-show="vote.tobeDeleted !== true" layout="row"> <md-button type="button" class="md-icon-button" ng-click="removeVote(id, $event)"> <md-icon class="material-icons">clear</md-icon> </md-button> <md-button type="button" class="md-accent md-raised">{{vote.expression}}</md-button> <span>有 {{vote.count}} 個人說：</span><div class="md-headline">{{vote.expression}}</div> </div> <div ng-repeat="(key, vote) in newPost.newVotes" layout="row"> <md-button type="button" class="md-icon-button" ng-click="removeNewVote(key)"> <md-icon class="material-icons">clear</md-icon> </md-button> <md-button type="button" class="md-accent md-raised">{{vote.expression}}</md-button> <span>有 {{vote.count}} 個人說：</span><div class="md-headline">{{vote.expression}}</div> </div> <div layout="row"> <input name="newVote" ng-model="newVote.expression"> <md-button type="button" class="md-raised" ng-click="addNewVote(newVote.expression)">增加投票按鈕</md-button> </div> </div> </form> </md-dialog-content> <div class="md-actions" layout="row"> <md-button ng-click="cancel()" class="md-raised md-primary"> 我按錯了 </md-button> <span flex></span> <md-button ng-click="post()" class="md-raised md-primary" ng-disabled="postForm.title.$invalid || postForm.author.$invalid || postForm.context.$invalid"> 完成 </md-button> </div> </md-dialog>'),a.put("views/progress.html",'<md-dialog aria-label="Show Progress"> <md-dialog-content> <div layout="row" layout-align="space-around center"> <div><md-progress-circular md-mode="indeterminate"></md-progress-circular></div> <div>{{message}}</div> </div> </md-dialog-content> </md-dialog>'),
a.put("views/report-issue.html",'<md-dialog aria-label="Report Issue" flex="60"> <md-dialog-content> <div ng-if="froalaOptions"> <h3>問題描述</h3> <div class="md-whiteframe-z3" layout-padding> <textarea froala="froalaOptions" ng-model="issue.description"></textarea> </div> </div> <md-checkbox ng-model="isSendingLogHistory">回報錯誤日誌</md-checkbox> <div ng-show="isSendingLogHistory"> <h5>以下系統日誌的錯誤訊息將會一併回報給開發團隊</h5> <md-content style="max-height:100px"> <p ng-repeat="log in readableLogs">[{{log.timestamp}}] {{log.context}}</p> </md-content> </div> <div layout="row"> <md-button class="md-primary md-raised" ng-click="cancel()">算了</md-button> <div flex></div> <md-button class="md-primary md-raised" ng-click="confirm()">確定送出</md-button> </div> </md-dialog-content> </md-dialog>'),a.put("views/server-intro.html",'<md-dialog aria-label="Server Intro" flex="60"> <md-toolbar> <div flex layout="row"> <div layout-margin> <img alt="{{server.title}}" ng-src="{{server.logo}}" class="md-avatar" ng-style="{\'max-width\':\'48px\', \'max-height\':\'48px\'}" ng-hide="server.logo == &quot;&quot;"> </div> <h1 class="md-headline">{{server.title}}</h1> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon class="material-icons">clear</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content style="min-height:350px"> <iframe width="100%" style="min-height:300px" ng-if="introUrl" ng-src="{{introUrl}}"></iframe> <div ng-bind-html="introContent"></div> <div layout="row" layout-align="center center"> <md-button class="md-raised md-primary" style="width:100%" ng-click="switchServer(server.name)" ng-disabled="isAlreadySelected"> <span class="md-headline">切換電台</span> </md-button> </div> </md-dialog-content> </md-dialog>'),a.put("views/server-list.html",'<md-list> <md-list-item ng-repeat="(name, server) in servers" ng-show="server.show" ng-click="showServerIntro(name)"> <img alt="{{ server.title }}" ng-src="{{ server.logo }}" class="md-avatar"> <p flex>{{ server.title}}</p> <md-button class="md-icon-button" aria-label="Remove" ng-click="removeServer(name); $event.stopPropagation()"> <md-icon class="material-icons">clear</md-icon> </md-button> </md-list-item> <md-list-item> <md-input-container flex> <label>新增電台傳送門網址</label> <input ng-model="newServerPortalUrl" ng-keypress="$event.keyCode == 13 && addServer(newServerPortalUrl)"> </md-input-container> <md-button class="md-icon-button" aria-label="Add" ng-click="addServer(newServerPortalUrl)"> <md-icon class="material-icons">add</md-icon> </md-button> </md-list-item> </md-list>'),a.put("views/sidenav.html",'<md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="sidenav-left"> <md-toolbar> <div class="md-toolbar-tools"> <md-button class="md-icon-button" aria-label="Server List" ng-click="switchPane(&quot;server-list&quot;)"> <md-tooltip class="md-body-2">電台</md-tooltip> <md-icon class="material-icons" ng-style="selectedPane == &quot;server-list&quot; && {color: &quot;white&quot;} || {color: &quot;lightgrey&quot;}">radio</md-icon> </md-button> <md-button class="md-icon-button" aria-label="User Settings" ng-click="switchPane(&quot;settings&quot;)"> <md-tooltip class="md-body-2">設定</md-tooltip> <md-icon class="material-icons" ng-style="selectedPane == &quot;settings&quot; && {color: &quot;white&quot;} || {color: &quot;lightgrey&quot;}">settings</md-icon> </md-button> </div> </md-toolbar> <md-content> <div ng-show="selectedPane == &quot;server-list&quot;" ng-include="&quot;views/server-list.html&quot;" ng-controller="ServerListController"> </div> <div ng-show="selectedPane == &quot;settings&quot;" ng-include="&quot;views/user-settings.html&quot;" ng-controller="UserSettingsController"> </div> </md-content> </md-sidenav>'),a.put("views/statusinfo.html",'<div ng-controller="StatusInfoController"> <div layout="row" layout-align="space-around center" style="max-height:48px"> <div style="color:white">{{message}}</div> <md-progress-circular class="md-accent" md-mode="indeterminate" md-diameter="20px" ng-show="showProgress"></md-progress-circular> </div> </div>'),a.put("views/user-settings.html",'<div> <div layout-padding> <h4>開啟網站時，顯示的地區範圍：</h4> <md-radio-group ng-model="settings.startUpAtMap"> <md-radio-button value="geolocation">自動定位我的位置</md-radio-button> <md-radio-button value="lastTime">上ㄧ次瀏覽的地區</md-radio-button> <div layout="row"> <md-radio-button value="useMapHome">使用地區首頁</md-radio-button> <md-button class="md-raised" ng-click="setMapHome()">設定首頁</md-button> </div> </md-radio-group> </div> <md-divider></md-divider> <md-checkbox ng-model="settings.autoOpenPostList">滑鼠指標停住地圖標示上方3秒後，自動開啟文章列表</md-checkbox> <md-divider></md-divider> <md-checkbox ng-model="settings.soundFX">開啟網站音效</md-checkbox> <md-divider></md-divider> <md-checkbox ng-model="settings.showToastTips">在左下角顯示使用小撇步</md-checkbox> <md-divider></md-divider> <md-button class="md-raised" ng-click="unfollowAllPosts()">停止追蹤所有文章</md-button> <md-divider></md-divider> <md-button class="md-raised" ng-click="reportIssue()">回報問題給開發團隊</md-button> </div>')}]);